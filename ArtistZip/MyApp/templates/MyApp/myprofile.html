{% extends 'MyApp/base.html' %}
{% load static %}
{% block content %}
<div class="myprofile-container">
    <div class="myprofile-header">
        <div class="myprofile-info">
            {% if user.profile_picture %}
                <img src="{{ user.profile_picture.url }}" alt="프로필 이미지" class="myprofile-image" />
            {% else %}
                <div class="myprofile-image avatar-placeholder"></div>
            {% endif %}
            <span class="myprofile-name">{{ user.username }}님</span>
            <a href="{% url 'edit_profile' %}">
                <button class="myprofile-action-btn">내 정보 수정하기</button>
            </a>
        </div>
    </div>

    {% if user.is_artist %}
        {% if artworks %}
        <div class="gallery-content">
            {% for artwork in artworks %}
            <div class="gallery-column">
                <div class="gallery-item">
                    <img
                        src="{{ artwork.artwork_image.url }}"
                        alt="{{ artwork.artwork_title }}"
                        class="gallery-image"
                    />
                    <div class="gallery-text">
                        <div class="gallery-title">
                            <h3>{{ artwork.artwork_title }}</h3>
                        </div>
                        <p>{{ artwork.artwork_description }}</p>
                        <div class="gallery-buttons">
                            <a href="{% url 'edit_artwork' artwork.id %}">
                                <button class="gallery-action-btn">편집</button>
                            </a>
                            <button class="gallery-action-btn" onclick="confirmDelete('{{ artwork.id }}')">삭제</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>아직 작품을 저장하지 않았습니다.</p>
        {% endif %}
    
        <div class="myprofile-actions">
            <button class="myprofile-action-btn" id="myprofilePreviewBtn" onclick="openModal()">템플릿 미리보기</button>
            <a href="{% url 'template' user.id %}">
                <button class="myprofile-action-btn">작품 업로드</button>
            </a>
            <a href="{% url 'portfolio_list' user.id %}">
                <button class="myprofile-action-btn">포트폴리오 보기</button>
            </a>
        </div>
    {% else %}
        <h2>구독한 아티스트</h2>
        <div class="artists-gallery">
            {% for subscription in subscriptions %}
            <div class="artist-card">
                {% if subscription.subscribed_to.profile_picture %}
                <img src="{{ subscription.subscribed_to.profile_picture.url }}" class="myprofile-image">
                {% else %}
                <div class="myprofile-image avatar-placeholder"></div>
                {% endif %}
                <div class="artist-name">{{ subscription.subscribed_to.username }}</div>
                <a href="{% url 'profile' subscription.subscribed_to.id %}" class="unstyled-link portfolio-button">프로필 보기</a>
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- 모달 오버레이 -->
<div id="modal-overlay" class="modal-overlay"></div>

<!-- 모달 -->
<div id="myprofile-modal" class="myprofile-modal">
    <div class="myprofile-modal-content">
        <span class="myprofile-close" onclick="closeModal()">&times;</span>
        <div class="myprofile-modal-body">
            <div class="template-container">
                <div class="template-text-content">
                    <p class="template-subtitle">움직임을 표현하고 싶은 아티스트라면,</p>
                    <h1 class="template-title">예술적인 템플릿</h1>
                    <a id="templateSelectBtn" href="#">
                        <button class="template-select-btn">구경하기</button>
                    </a>
                </div>
                <div class="template-image-content">
                    <div class="template-preview-image-container">
                        <img
                            src="{% static 'images/template1.png' %}"
                            alt="Template Preview"
                            class="template-preview-image"
                            id="templateImage"
                        />
                    </div>
                </div>
                <div class="template-navigation">
                    <button class="template-nav-btn template-prev" id="templatePrevBtn" onclick="changeTemplate(-1)">
                        <img src="{% static 'images/left_arrow.png' %}" alt="Previous" />
                    </button>
                    <button class="template-nav-btn template-next" id="templateNextBtn" onclick="changeTemplate(1)">
                        <img src="{% static 'images/right_arrow.png' %}" alt="Next" />
                    </button>
                </div>
                <div class="template-indicators">
                    <span class="template-indicator active"></span>
                    <span class="template-indicator"></span>
                    <span class="template-indicator"></span>
                    <span class="template-indicator"></span>
                    <span class="template-indicator"></span>
                    <span class="template-indicator"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .template-preview-image-container {
        height: 400px;
        overflow: hidden;
    }
    .template-preview-image {
        width: 100%;
        object-fit: cover;
        object-position: top;
    }
    .artists-gallery {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    .artist-card {
        margin: 10px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        text-align: center;
        width: 200px;
    }
    .artist-card img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }
    .artist-name {
        font-size: 1.2em;
        margin-top: 10px;
    }
    .portfolio-button {
        margin-top: 10px;
        display: block;
        padding: 10px;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        text-decoration: none;
    }
</style>

<script>
    const templates = [
        "{% static 'images/template1.png' %}",
        "{% static 'images/template2.png' %}",
        "{% static 'images/template3.png' %}",
        "{% static 'images/template4.png' %}",
        "{% static 'images/template5.png' %}",
        "{% static 'images/template6.png' %}",
    ];

    const templateUrls = [
        "{% url 'portfolio1' user.id %}",
        "{% url 'portfolio2' user.id %}",
        "{% url 'portfolio3' user.id %}",
        "{% url 'portfolio4' user.id %}",
        "{% url 'portfolio5' user.id %}",
        "{% url 'portfolio6' user.id %}"
    ];

    let currentTemplateIndex = 0;

    function openModal() {
        document.getElementById("modal-overlay").style.display = "block";
        document.getElementById("myprofile-modal").style.display = "block";
        document.body.style.overflow = "hidden";
        updateSelectButton();
    }

    function closeModal() {
        document.getElementById("modal-overlay").style.display = "none";
        document.getElementById("myprofile-modal").style.display = "none";
        document.body.style.overflow = "auto";
    }

    function confirmDelete(artworkId) {
        if (confirm("해당 작품을 삭제하시겠습니까?")) {
            window.location.href = "{% url 'delete_artwork' %}?id=" + artworkId;
        }
    }

    function changeTemplate(direction) {
        currentTemplateIndex = (currentTemplateIndex + direction + templates.length) % templates.length;
        document.getElementById("templateImage").src = templates[currentTemplateIndex];
        updateIndicators();
        updateSelectButton();
    }

    function updateIndicators() {
        const indicators = document.querySelectorAll(".template-indicator");
        indicators.forEach((indicator, index) => {
            if (index === currentTemplateIndex) {
                indicator.classList.add("active");
            } else {
                indicator.classList.remove("active");
            }
        });
    }

    function updateSelectButton() {
        const selectButton = document.getElementById("templateSelectBtn");
        selectButton.href = templateUrls[currentTemplateIndex];
    }
</script>
{% endblock %}
